# GCS (Google Cloud Storage) Example
#
# This workflow demonstrates how to:
# 1. Create a GCS client
# 2. Get a bucket reference
# 3. Check if an object exists
# 4. Download object content as bytes
# 5. Get object metadata
#
# Prerequisites:
# - pip install lexflow[gcs]
# - gcloud auth application-default login
#
# Usage:
# lexflow gcs_example.yaml

workflows:
  - name: main
    interface:
      inputs: []
      outputs: []
    variables:
      client: null
      bucket: null
      object_bytes: null
      metadata: null
      exists: false
    nodes:
      start:
        opcode: workflow_start
        next: intro
        inputs: {}

      intro:
        opcode: io_print
        next: store_client
        inputs:
          STRING:
            literal: "=== GCS Download Example ===\n\n"

      # Step 1: Create GCS client
      create_client:
        opcode: gcs_create_client
        isReporter: true
        inputs:
          project:
            literal: "your-project-id"

      store_client:
        opcode: data_set_variable_to
        next: print_client_created
        inputs:
          VARIABLE:
            literal: "client"
          VALUE:
            node: create_client

      print_client_created:
        opcode: io_print
        next: store_bucket
        inputs:
          STRING:
            literal: "1. GCS client created\n"

      # Step 2: Get bucket reference
      get_bucket:
        opcode: gcs_get_bucket
        isReporter: true
        inputs:
          client:
            variable: "client"
          bucket_name:
            literal: "your-bucket-name"

      store_bucket:
        opcode: data_set_variable_to
        next: print_bucket_obtained
        inputs:
          VARIABLE:
            literal: "bucket"
          VALUE:
            node: get_bucket

      print_bucket_obtained:
        opcode: io_print
        next: store_exists
        inputs:
          STRING:
            literal: "2. Bucket reference obtained\n"

      # Step 3: Check if object exists
      check_exists:
        opcode: gcs_object_exists
        isReporter: true
        inputs:
          bucket:
            variable: "bucket"
          object_name:
            literal: "path/to/your/file.pdf"

      store_exists:
        opcode: data_set_variable_to
        next: print_exists
        inputs:
          VARIABLE:
            literal: "exists"
          VALUE:
            node: check_exists

      print_exists:
        opcode: io_print
        next: store_metadata
        inputs:
          STRING:
            node: exists_message

      exists_message:
        opcode: operator_add
        isReporter: true
        inputs:
          left:
            literal: "3. Object exists: "
          right:
            node: exists_str

      exists_str:
        opcode: str
        isReporter: true
        inputs:
          value:
            variable: "exists"

      # Step 4: Get object metadata
      get_metadata:
        opcode: gcs_get_object_metadata
        isReporter: true
        inputs:
          bucket:
            variable: "bucket"
          object_name:
            literal: "path/to/your/file.pdf"

      store_metadata:
        opcode: data_set_variable_to
        next: print_metadata
        inputs:
          VARIABLE:
            literal: "metadata"
          VALUE:
            node: get_metadata

      print_metadata:
        opcode: io_print
        next: store_bytes
        inputs:
          STRING:
            literal: "\n4. Object metadata retrieved\n"

      # Step 5: Download object as bytes
      download_bytes:
        opcode: gcs_download_object_as_bytes
        isReporter: true
        inputs:
          bucket:
            variable: "bucket"
          object_name:
            literal: "path/to/your/file.pdf"

      store_bytes:
        opcode: data_set_variable_to
        next: print_downloaded
        inputs:
          VARIABLE:
            literal: "object_bytes"
          VALUE:
            node: download_bytes

      print_downloaded:
        opcode: io_print
        next: final_message
        inputs:
          STRING:
            literal: "5. Object downloaded as bytes\n"

      final_message:
        opcode: io_print
        next: null
        inputs:
          STRING:
            literal: "\n=== GCS operations completed! ===\n"
