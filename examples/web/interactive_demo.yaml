# Interactive Web Demo
# Run this with the web frontend to see interactive web opcodes in action
#
# Note: web_send and web_recv channels are automatically injected by the
# WebSocket handler when running in the web frontend.

workflows:
  - name: main
    interface:
      inputs: ["web_send", "web_recv"]
      outputs: []
    variables:
      user_name: ""
      favorite_color: ""
    nodes:
      start:
        opcode: workflow_start
        next: greet
        inputs: {}

      greet:
        opcode: web_markdown
        next: save_name
        inputs:
          web_send:
            variable: web_send
          content:
            literal: "# Welcome to LexFlow!\n\nThis demo shows interactive web opcodes."

      # Reporter: prompts for name input
      ask_name:
        opcode: web_input
        isReporter: true
        inputs:
          web_send:
            variable: web_send
          web_recv:
            variable: web_recv
          prompt:
            literal: "What is your name?"

      save_name:
        opcode: data_set_variable_to
        next: show_greeting
        inputs:
          VARIABLE:
            literal: "user_name"
          VALUE:
            node: ask_name

      # Reporter: builds greeting message
      greeting_msg:
        opcode: operator_add
        isReporter: true
        inputs:
          left:
            literal: "Hello, "
          right:
            node: add_exclaim

      add_exclaim:
        opcode: operator_add
        isReporter: true
        inputs:
          left:
            variable: user_name
          right:
            literal: "!"

      show_greeting:
        opcode: web_alert
        next: save_color
        inputs:
          web_send:
            variable: web_send
          message:
            node: greeting_msg
          variant:
            literal: "success"

      # Reporter: prompts for color selection
      ask_color:
        opcode: web_select
        isReporter: true
        inputs:
          web_send:
            variable: web_send
          web_recv:
            variable: web_recv
          options:
            literal: ["Red", "Green", "Blue", "Purple"]
          prompt:
            literal: "What's your favorite color?"

      save_color:
        opcode: data_set_variable_to
        next: show_color
        inputs:
          VARIABLE:
            literal: "favorite_color"
          VALUE:
            node: ask_color

      # Reporter: builds color message
      color_msg:
        opcode: operator_add
        isReporter: true
        inputs:
          left:
            literal: "You chose: **"
          right:
            node: color_msg_end

      color_msg_end:
        opcode: operator_add
        isReporter: true
        inputs:
          left:
            variable: favorite_color
          right:
            literal: "**"

      show_color:
        opcode: web_markdown
        next: check_confirm
        inputs:
          web_send:
            variable: web_send
          content:
            node: color_msg

      # Reporter: prompts for confirmation
      confirm_done:
        opcode: web_confirm
        isReporter: true
        inputs:
          web_send:
            variable: web_send
          web_recv:
            variable: web_recv
          message:
            literal: "Would you like to see a progress demo?"

      check_confirm:
        opcode: control_if
        next: finish
        inputs:
          CONDITION:
            node: confirm_done
          THEN:
            branch: progress_demo

      progress_demo:
        opcode: web_progress
        next: progress_50
        inputs:
          web_send:
            variable: web_send
          value:
            literal: 25
          max:
            literal: 100
          label:
            literal: "Loading..."

      progress_50:
        opcode: web_progress
        next: progress_75
        inputs:
          web_send:
            variable: web_send
          value:
            literal: 50
          max:
            literal: 100
          label:
            literal: "Processing..."

      progress_75:
        opcode: web_progress
        next: progress_100
        inputs:
          web_send:
            variable: web_send
          value:
            literal: 75
          max:
            literal: 100
          label:
            literal: "Almost done..."

      progress_100:
        opcode: web_progress
        next: show_table
        inputs:
          web_send:
            variable: web_send
          value:
            literal: 100
          max:
            literal: 100
          label:
            literal: "Complete!"

      show_table:
        opcode: web_table
        next: null
        inputs:
          web_send:
            variable: web_send
          data:
            literal:
              - name: Alice
                score: 95
              - name: Bob
                score: 87
              - name: Charlie
                score: 92

      finish:
        opcode: web_alert
        next: null
        inputs:
          web_send:
            variable: web_send
          message:
            literal: "Demo complete! Thanks for trying LexFlow."
          variant:
            literal: "info"
