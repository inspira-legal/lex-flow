# Example: News Search
#
# This workflow demonstrates searching for recent news using the Tavily API.
#
# Prerequisites:
#   - pip install lexflow[search]
#   - Set TAVILY_API_KEY environment variable
#
# Run:
#   TAVILY_API_KEY=your-key uv run lexflow examples/web_search/news_search.yaml --input topic="artificial intelligence"

workflows:
  - name: main
    interface:
      inputs: ["topic"]
      outputs: []
    variables:
      topic: "technology startups"
      results: null
      result: null
    nodes:
      start:
        opcode: workflow_start
        next: print_header
        inputs: {}

      print_header:
        opcode: io_print
        next: do_search
        inputs:
          STRING:
            literal: "\n=== News Search Demo ===\n\n"

      # === Perform News Search ===

      search:
        opcode: web_search_news
        isReporter: true
        inputs:
          query:
            variable: topic
          max_results:
            literal: 5
          time_range:
            literal: "week"

      do_search:
        opcode: data_set_variable_to
        next: print_topic
        inputs:
          VARIABLE:
            literal: "results"
          VALUE:
            node: search

      # === Display Results ===

      print_topic:
        opcode: io_print
        next: print_topic_value
        inputs:
          STRING:
            literal: "Topic: "

      print_topic_value:
        opcode: io_print
        next: print_time_range
        inputs:
          STRING:
            variable: topic

      print_time_range:
        opcode: io_print
        next: get_results_list
        inputs:
          STRING:
            literal: "\nTime range: Past week\n\nNews Articles:\n"

      # Get results array from response
      results_list:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: results
          key:
            literal: "results"

      get_results_list:
        opcode: data_set_variable_to
        next: loop_results
        inputs:
          VARIABLE:
            literal: "results"
          VALUE:
            node: results_list

      # === Loop Through Results ===

      loop_results:
        opcode: control_foreach
        next: print_footer
        inputs:
          VAR:
            literal: "result"
          ITERABLE:
            variable: results
          BODY:
            branch: print_result

      # === Print Each Result ===

      print_result:
        opcode: io_print
        next: print_title
        inputs:
          STRING:
            literal: "\n---\n"

      get_title:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: result
          key:
            literal: "title"

      print_title:
        opcode: io_print
        next: print_url_label
        inputs:
          STRING:
            node: get_title

      print_url_label:
        opcode: io_print
        next: print_url
        inputs:
          STRING:
            literal: "\nURL: "

      get_url:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: result
          key:
            literal: "url"

      print_url:
        opcode: io_print
        next: print_content_label
        inputs:
          STRING:
            node: get_url

      print_content_label:
        opcode: io_print
        next: print_content
        inputs:
          STRING:
            literal: "\nSummary: "

      get_content:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: result
          key:
            literal: "content"

      print_content:
        opcode: io_print
        next: null
        inputs:
          STRING:
            node: get_content

      # === Footer ===

      print_footer:
        opcode: io_print
        next: null
        inputs:
          STRING:
            literal: "\n\n=== News Search Complete ===\n"
