# Example: Basic Web Search
#
# This workflow demonstrates basic web search functionality using the Tavily API.
#
# Prerequisites:
#   - pip install lexflow[search]
#   - Set TAVILY_API_KEY environment variable
#
# Run:
#   TAVILY_API_KEY=your-key uv run lexflow examples/web_search/basic_search.yaml --input query="Python 3.12 features"

workflows:
  - name: main
    interface:
      inputs: ["query"]
      outputs: []
    variables:
      query: "Python programming best practices"
      results: null
      result: null
      i: 0
    nodes:
      start:
        opcode: workflow_start
        next: print_header
        inputs: {}

      print_header:
        opcode: io_print
        next: do_search
        inputs:
          STRING:
            literal: "\n=== Web Search Demo ===\n\n"

      # === Perform Search ===

      search:
        opcode: web_search
        isReporter: true
        inputs:
          query:
            variable: query
          max_results:
            literal: 5
          search_depth:
            literal: "basic"

      do_search:
        opcode: data_set_variable_to
        next: print_query
        inputs:
          VARIABLE:
            literal: "results"
          VALUE:
            node: search

      # === Display Results ===

      print_query:
        opcode: io_print
        next: print_query_value
        inputs:
          STRING:
            literal: "Query: "

      print_query_value:
        opcode: io_print
        next: print_newline1
        inputs:
          STRING:
            variable: query

      print_newline1:
        opcode: io_print
        next: print_results_header
        inputs:
          STRING:
            literal: "\n\n"

      print_results_header:
        opcode: io_print
        next: get_results_list
        inputs:
          STRING:
            literal: "Results:\n"

      # Get results array from response
      results_list:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: results
          key:
            literal: "results"

      get_results_list:
        opcode: data_set_variable_to
        next: loop_results
        inputs:
          VARIABLE:
            literal: "results"
          VALUE:
            node: results_list

      # === Loop Through Results ===

      loop_results:
        opcode: control_foreach
        next: print_footer
        inputs:
          VAR:
            literal: "result"
          ITERABLE:
            variable: results
          BODY:
            branch: print_result

      # === Print Each Result ===

      print_result:
        opcode: io_print
        next: print_title
        inputs:
          STRING:
            literal: "\n---\n"

      get_title:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: result
          key:
            literal: "title"

      print_title:
        opcode: io_print
        next: print_url_label
        inputs:
          STRING:
            node: get_title

      print_url_label:
        opcode: io_print
        next: print_url
        inputs:
          STRING:
            literal: "\nURL: "

      get_url:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: result
          key:
            literal: "url"

      print_url:
        opcode: io_print
        next: print_content_label
        inputs:
          STRING:
            node: get_url

      print_content_label:
        opcode: io_print
        next: print_content
        inputs:
          STRING:
            literal: "\nContent: "

      get_content:
        opcode: dict_get
        isReporter: true
        inputs:
          d:
            variable: result
          key:
            literal: "content"

      print_content:
        opcode: io_print
        next: null
        inputs:
          STRING:
            node: get_content

      # === Footer ===

      print_footer:
        opcode: io_print
        next: null
        inputs:
          STRING:
            literal: "\n\n=== Search Complete ===\n"
