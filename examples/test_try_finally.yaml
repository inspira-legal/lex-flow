workflows:
  - name: main
    interface:
      inputs: []
      outputs: []
    variables:
      cleanup_executed: false
    nodes:
      start:
        opcode: workflow_start
        next: print_intro
        inputs: {}

      print_intro:
        opcode: io_print
        next: test_try_finally
        inputs:
          STRING:
            literal: "=== Testing Try-Finally ===\n\n"

      # Test try-finally without exception
      test_try_finally:
        opcode: control_try
        next: check_cleanup
        inputs:
          TRY:
            branch: normal_execution
          FINALLY:
            branch: cleanup

      normal_execution:
        opcode: io_print
        next: null
        inputs:
          STRING:
            literal: "✓ Normal execution completed\n"

      cleanup:
        opcode: data_set_variable_to
        next: print_cleanup
        inputs:
          VARIABLE:
            literal: cleanup_executed
          VALUE:
            literal: true

      print_cleanup:
        opcode: io_print
        next: null
        inputs:
          STRING:
            literal: "✓ Finally block executed\n"

      check_cleanup:
        opcode: control_if_else
        inputs:
          CONDITION:
            node: cleanup_check
          BRANCH1:
            branch: cleanup_success
          BRANCH2:
            branch: cleanup_failed

      cleanup_check:
        opcode: operator_equals
        inputs:
          left:
            variable: cleanup_executed
          right:
            literal: true
        isReporter: true

      cleanup_success:
        opcode: io_print
        next: null
        inputs:
          STRING:
            literal: "\n✅ Try-finally test passed!\n"

      cleanup_failed:
        opcode: io_print
        next: null
        inputs:
          STRING:
            literal: "\n✗ Finally block did not execute!\n"
