{
  "version": "1.0",
  "categories": [
    {
      "id": "control",
      "prefix": "control_",
      "label": "Control Flow",
      "color": "#FF9500",
      "icon": "\u27f3"
    },
    {
      "id": "data",
      "prefix": "data_",
      "label": "Data",
      "color": "#4CAF50",
      "icon": "\ud83d\udce6"
    },
    {
      "id": "io",
      "prefix": "io_",
      "label": "I/O",
      "color": "#22D3EE",
      "icon": "\ud83d\udce4"
    },
    {
      "id": "operator",
      "prefix": "operator_",
      "label": "Operators",
      "color": "#9C27B0",
      "icon": "\u26a1"
    },
    {
      "id": "list",
      "prefix": "list_",
      "label": "Lists",
      "color": "#3B82F6",
      "icon": "\ud83d\udccb"
    },
    {
      "id": "dict",
      "prefix": "dict_",
      "label": "Dicts",
      "color": "#F59E0B",
      "icon": "\ud83d\udcd6"
    },
    {
      "id": "string",
      "prefix": "string_",
      "label": "Strings",
      "color": "#F472B6",
      "icon": "\ud83d\udcdd"
    },
    {
      "id": "math",
      "prefix": "math_",
      "label": "Math",
      "color": "#8B5CF6",
      "icon": "\ud83d\udd22"
    },
    {
      "id": "workflow",
      "prefix": "workflow_",
      "label": "Workflow",
      "color": "#E91E63",
      "icon": "\ud83d\udd17"
    },
    {
      "id": "async",
      "prefix": "async_",
      "label": "Async",
      "color": "#06B6D4",
      "icon": "\u23f1"
    },
    {
      "id": "ai",
      "prefix": "ai_",
      "label": "AI",
      "color": "#10B981",
      "icon": "\ud83e\udd16"
    }
  ],
  "constructs": [
    {
      "opcode": "control_if",
      "display_name": "If",
      "ast_class": "If",
      "category": "control",
      "description": "Execute branch if condition is true.",
      "inputs": [
        {
          "name": "CONDITION",
          "type": "expression",
          "label": "Condition",
          "value_type": "bool",
          "required": true
        }
      ],
      "branches": [
        {
          "name": "THEN",
          "label": "Then",
          "color": "#66BB6A",
          "required": true
        }
      ]
    },
    {
      "opcode": "control_if_else",
      "display_name": "If-Else",
      "ast_class": "If",
      "category": "control",
      "description": "Execute then-branch if condition is true, else-branch otherwise.",
      "inputs": [
        {
          "name": "CONDITION",
          "type": "expression",
          "label": "Condition",
          "value_type": "bool",
          "required": true
        }
      ],
      "branches": [
        {
          "name": "THEN",
          "label": "Then",
          "color": "#66BB6A",
          "required": true
        },
        {
          "name": "ELSE",
          "label": "Else",
          "color": "#EF5350",
          "required": true
        }
      ]
    },
    {
      "opcode": "control_while",
      "display_name": "While",
      "ast_class": "While",
      "category": "control",
      "description": "Repeat body while condition is true.",
      "inputs": [
        {
          "name": "CONDITION",
          "type": "expression",
          "label": "Condition",
          "value_type": "bool",
          "required": true
        }
      ],
      "branches": [
        {
          "name": "BODY",
          "label": "Body",
          "color": "#22D3EE",
          "required": true
        }
      ]
    },
    {
      "opcode": "control_for",
      "display_name": "For",
      "ast_class": "For",
      "category": "control",
      "description": "For loop with counter variable.",
      "inputs": [
        {
          "name": "VAR",
          "type": "variable_name",
          "label": "Variable",
          "required": true
        },
        {
          "name": "START",
          "type": "expression",
          "label": "Start",
          "value_type": "int",
          "required": true
        },
        {
          "name": "END",
          "type": "expression",
          "label": "End",
          "value_type": "int",
          "required": true
        },
        {
          "name": "STEP",
          "type": "expression",
          "label": "Step",
          "value_type": "int",
          "required": false,
          "default": 1
        }
      ],
      "branches": [
        {
          "name": "BODY",
          "label": "Body",
          "color": "#22D3EE",
          "required": true
        }
      ]
    },
    {
      "opcode": "control_foreach",
      "display_name": "ForEach",
      "ast_class": "ForEach",
      "category": "control",
      "description": "Iterate over each item in a collection.",
      "inputs": [
        {
          "name": "VAR",
          "type": "variable_name",
          "label": "Variable",
          "required": true
        },
        {
          "name": "ITERABLE",
          "type": "expression",
          "label": "Iterable",
          "value_type": "list",
          "required": true
        }
      ],
      "branches": [
        {
          "name": "BODY",
          "label": "Body",
          "color": "#22D3EE",
          "required": true
        }
      ]
    },
    {
      "opcode": "control_fork",
      "display_name": "Fork",
      "ast_class": "Fork",
      "category": "control",
      "description": "Execute multiple branches concurrently.",
      "inputs": [],
      "branches": [
        {
          "name": "BRANCH1",
          "label": "Branch 1",
          "color": "#9C27B0",
          "required": true
        },
        {
          "name": "BRANCH2",
          "label": "Branch 2",
          "color": "#9C27B0",
          "required": false
        }
      ],
      "dynamic_branches": true
    },
    {
      "opcode": "control_try",
      "display_name": "Try",
      "ast_class": "Try",
      "category": "control",
      "description": "Exception handling with try/catch/finally.",
      "inputs": [],
      "branches": [
        {
          "name": "TRY",
          "label": "Try",
          "color": "#3B82F6",
          "required": true
        },
        {
          "name": "CATCH1",
          "label": "Catch",
          "color": "#F87171",
          "required": false,
          "catch_config": {
            "exception_type": "string",
            "var_name": "string"
          }
        },
        {
          "name": "FINALLY",
          "label": "Finally",
          "color": "#FACC15",
          "required": false
        }
      ],
      "dynamic_branches": true
    },
    {
      "opcode": "control_throw",
      "display_name": "Throw",
      "ast_class": "Throw",
      "category": "control",
      "description": "Raise an exception with a message.",
      "inputs": [
        {
          "name": "VALUE",
          "type": "expression",
          "label": "Message",
          "value_type": "string",
          "required": true
        }
      ],
      "branches": []
    },
    {
      "opcode": "control_spawn",
      "display_name": "Spawn",
      "ast_class": "Spawn",
      "category": "control",
      "description": "Spawn a background task.",
      "inputs": [
        {
          "name": "VAR",
          "type": "variable_name",
          "label": "Task Variable",
          "required": false
        }
      ],
      "branches": [
        {
          "name": "BODY",
          "label": "Body",
          "color": "#22D3EE",
          "required": true
        }
      ]
    },
    {
      "opcode": "control_async_foreach",
      "display_name": "Async ForEach",
      "ast_class": "AsyncForEach",
      "category": "control",
      "description": "Async iteration over a stream or async iterable.",
      "inputs": [
        {
          "name": "VAR",
          "type": "variable_name",
          "label": "Variable",
          "required": true
        },
        {
          "name": "ITERABLE",
          "type": "expression",
          "label": "Async Iterable",
          "value_type": "async_iterable",
          "required": true
        }
      ],
      "branches": [
        {
          "name": "BODY",
          "label": "Body",
          "color": "#22D3EE",
          "required": true
        }
      ]
    },
    {
      "opcode": "async_timeout",
      "display_name": "Timeout",
      "ast_class": "Timeout",
      "category": "async",
      "description": "Execute body with a timeout, with optional fallback.",
      "inputs": [
        {
          "name": "TIMEOUT",
          "type": "expression",
          "label": "Timeout (seconds)",
          "value_type": "float",
          "required": true
        }
      ],
      "branches": [
        {
          "name": "BODY",
          "label": "Body",
          "color": "#22D3EE",
          "required": true
        },
        {
          "name": "ON_TIMEOUT",
          "label": "On Timeout",
          "color": "#FACC15",
          "required": false
        }
      ]
    },
    {
      "opcode": "control_with",
      "display_name": "With",
      "ast_class": "With",
      "category": "control",
      "description": "Async context manager (with statement).",
      "inputs": [
        {
          "name": "RESOURCE",
          "type": "expression",
          "label": "Resource",
          "required": true
        },
        {
          "name": "VAR",
          "type": "variable_name",
          "label": "Variable",
          "required": true
        }
      ],
      "branches": [
        {
          "name": "BODY",
          "label": "Body",
          "color": "#22D3EE",
          "required": true
        }
      ]
    },
    {
      "opcode": "data_set_variable_to",
      "display_name": "Set Variable",
      "ast_class": "Assign",
      "category": "data",
      "description": "Assign a value to a variable.",
      "inputs": [
        {
          "name": "VARIABLE",
          "type": "variable_name",
          "label": "Variable",
          "required": true
        },
        {
          "name": "VALUE",
          "type": "expression",
          "label": "Value",
          "required": true
        }
      ],
      "branches": []
    },
    {
      "opcode": "workflow_return",
      "display_name": "Return",
      "ast_class": "Return",
      "category": "workflow",
      "description": "Return value(s) from workflow.",
      "inputs": [
        {
          "name": "VALUE",
          "type": "expression",
          "label": "Value",
          "required": false
        }
      ],
      "branches": [],
      "dynamic_inputs": true
    },
    {
      "opcode": "workflow_call",
      "display_name": "Call Workflow",
      "ast_class": "ExprStmt",
      "category": "workflow",
      "description": "Call another workflow by name.",
      "inputs": [
        {
          "name": "WORKFLOW",
          "type": "variable_name",
          "label": "Workflow Name",
          "required": true
        }
      ],
      "branches": [],
      "dynamic_inputs": true
    },
    {
      "opcode": "workflow_start",
      "display_name": "Start",
      "ast_class": null,
      "category": "workflow",
      "description": "Entry point for workflow execution.",
      "inputs": [],
      "branches": []
    },
    {
      "opcode": "ai_agent_with_tools",
      "display_name": "AI Agent with Tools",
      "ast_class": "Opcode",
      "category": "ai",
      "description": "Run an AI agent with access to LexFlow opcodes as tools",
      "inputs": [
        {
          "name": "agent",
          "type": "expression",
          "label": "Agent",
          "value_type": "object",
          "required": true
        },
        {
          "name": "messages",
          "type": "expression",
          "label": "Messages",
          "value_type": "string|list",
          "required": true
        },
        {
          "name": "tools",
          "type": "expression",
          "label": "Tools (opcode names)",
          "value_type": "list",
          "required": true
        },
        {
          "name": "output",
          "type": "expression",
          "label": "Output Schema",
          "value_type": "object",
          "required": false
        },
        {
          "name": "max_tool_calls",
          "type": "expression",
          "label": "Max Tool Calls",
          "value_type": "int",
          "required": false,
          "default": 10
        },
        {
          "name": "timeout_seconds",
          "type": "expression",
          "label": "Timeout (seconds)",
          "value_type": "float",
          "required": false,
          "default": 300
        }
      ],
      "branches": []
    }
  ],
  "branch_colors": {
    "THEN": "#34D399",
    "ELSE": "#F87171",
    "BODY": "#22D3EE",
    "TRY": "#3B82F6",
    "CATCH": "#F87171",
    "FINALLY": "#FACC15",
    "ON_TIMEOUT": "#FACC15",
    "BRANCH": "#9C27B0",
    "default": "#9C27B0"
  },
  "node_colors": {
    "control_flow": "#FF9500",
    "data": "#4CAF50",
    "io": "#22D3EE",
    "operator": "#9C27B0",
    "workflow_op": "#E91E63",
    "opcode": "#64748B"
  },
  "reporter_colors": {
    "data": "#4CAF50",
    "operator": "#9C27B0",
    "io": "#22D3EE",
    "workflow": "#E91E63",
    "default": "#64748B"
  }
}
